
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../aligners/">
      
      
        <link rel="next" href="../formatters/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Validators - Chisel</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#validators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Chisel" class="md-header__button md-logo" aria-label="Chisel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chisel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Validators
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mhaugestad/chisel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../parsers/" class="md-tabs__link">
          
  
  
  Components

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/conll/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chisel" class="md-nav__button md-logo" aria-label="Chisel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Chisel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mhaugestad/chisel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parsers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokenizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tokenizers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../labelers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labelers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chunkers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chunkers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aligners/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aligners
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Validators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Validators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-validators" class="md-nav__link">
    <span class="md-ellipsis">
      Why Validators?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parse-validators" class="md-nav__link">
    <span class="md-ellipsis">
      🔍 Parse Validators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍 Parse Validators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protocol" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-defaultparsevalidator" class="md-nav__link">
    <span class="md-ellipsis">
      🛠️ Implementation: DefaultParseValidator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      💡 Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-alignment-validators" class="md-nav__link">
    <span class="md-ellipsis">
      🧷 Token Alignment Validators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧷 Token Alignment Validators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protocol_1" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-hftokenalignmentvalidator" class="md-nav__link">
    <span class="md-ellipsis">
      🛠️ Implementation: HFTokenAlignmentValidator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    <span class="md-ellipsis">
      💡 Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on_error-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      ⚠️ on_error Behavior
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skipping-only-the-broken-spans" class="md-nav__link">
    <span class="md-ellipsis">
      Skipping Only the Broken Spans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-custom-validators" class="md-nav__link">
    <span class="md-ellipsis">
      🛠️ Implementing Custom Validators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🛠️ Implementing Custom Validators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-parsevalidator" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Custom ParseValidator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-tokenalignmentvalidator" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Custom TokenAlignmentValidator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tip-chain-multiple-validators" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Tip: Chain Multiple Validators
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../formatters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Formatters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/conll/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CoNLL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/ncbi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCBI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/mhaugestad/chisel/edit/master/docs/components/validators.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="validators">✅ Validators<a class="headerlink" href="#validators" title="Permanent link">&para;</a></h1>
<p>Validators in Chisel help catch inconsistencies early in the preprocessing pipeline. They provide a flexible validation system to help catch annotation errors early — before they silently degrade your model performance.</p>
<h2 id="why-validators">Why Validators?<a class="headerlink" href="#why-validators" title="Permanent link">&para;</a></h2>
<p>When training token classification models, small inconsistencies in span alignment or label sequences can lead to misleading results, unstable training, or even complete failures downstream. Validators give you an explicit place to catch and handle these inconsistencies.</p>
<p>For example, if a span is misaligned with token boundaries or if a label sequence does not match the expected entity structure, a validator can flag it — and depending on configuration, either raise an error or continue gracefully.</p>
<p>They are divided into two categories:</p>
<h2 id="parse-validators">🔍 Parse Validators<a class="headerlink" href="#parse-validators" title="Permanent link">&para;</a></h2>
<p>Parse validators run before tokenization and ensure that the entity spans extracted by the parser are accurate with respect to the original text.</p>
<h3 id="protocol">🧩 Protocol<a class="headerlink" href="#protocol" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>@runtime_checkable
class ParseValidator(Protocol):
    on_error: Literal[&quot;warn&quot;, &quot;raise&quot;]

    def validate(self, text: str, span: EntitySpan) -&gt; None: ...
</code></pre></div>
<h3 id="implementation-defaultparsevalidator">🛠️ Implementation: <code>DefaultParseValidator</code><a class="headerlink" href="#implementation-defaultparsevalidator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>class DefaultParseValidator(ParseValidator):
    &quot;&quot;&quot;
    - Checks if entity text exists in the full text.
    - Checks if `entity.text` matches `text[start:end]`.
    - Checks for valid index boundaries.
    - Warns or raises on errors based on `on_error`.
    &quot;&quot;&quot;
</code></pre></div>
<h3 id="behavior">🔧 Behavior<a class="headerlink" href="#behavior" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Check</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entity.text in text</code></td>
<td>Ensures the string exists in the input text.</td>
</tr>
<tr>
<td><code>text[start:end] == entity.text</code></td>
<td>Confirms character indices match the string.</td>
</tr>
<tr>
<td><code>0 &lt;= start &lt; end &lt;= len(text)</code></td>
<td>Validates index boundaries.</td>
</tr>
<tr>
<td>Empty <code>text</code></td>
<td>Raises or warns on empty span texts.</td>
</tr>
</tbody>
</table>
<h3 id="usage">💡 Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>validator = DefaultParseValidator(on_error=&quot;raise&quot;)
validator.validate(text, span)
</code></pre></div>
<h2 id="token-alignment-validators">🧷 Token Alignment Validators<a class="headerlink" href="#token-alignment-validators" title="Permanent link">&para;</a></h2>
<p>These validators ensure that token-aligned entity spans can be reconstructed accurately from the token IDs using the tokenizer.</p>
<h3 id="protocol_1">🧩 Protocol<a class="headerlink" href="#protocol_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>@runtime_checkable
class TokenAlignmentValidator(Protocol):
    on_error: Literal[&quot;warn&quot;, &quot;raise&quot;]

    def validate(
        self, tokens: List[Token], span: TokenEntitySpan
    ) -&gt; None: ...
</code></pre></div>
<h3 id="implementation-hftokenalignmentvalidator">🛠️ Implementation: <code>HFTokenAlignmentValidator</code><a class="headerlink" href="#implementation-hftokenalignmentvalidator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>class HFTokenAlignmentValidator(TokenAlignmentValidator):
    &quot;&quot;&quot;
    - Tokenizes `entity.text` and decodes it.
    - Compares to decoded token IDs from aligned tokens.
    - Warns or raises if mismatch is found.
    &quot;&quot;&quot;
</code></pre></div>
<h3 id="behavior_1">🔧 Behavior<a class="headerlink" href="#behavior_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Check</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Decode <code>entity.text</code></td>
<td>Using HuggingFace tokenizer (<code>add_special_tokens=False</code>).</td>
</tr>
<tr>
<td>Decode token span using IDs</td>
<td>From <code>TokenEntitySpan.token_indices</code>.</td>
</tr>
<tr>
<td>Compare decoded strings</td>
<td>If mismatch, either warn or raise.</td>
</tr>
</tbody>
</table>
<h3 id="usage_1">💡 Usage<a class="headerlink" href="#usage_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>from transformers import AutoTokenizer
tokenizer = AutoTokenizer.from_pretrained(&quot;bert-base-cased&quot;)

validator = HFTokenAlignmentValidator(tokenizer=tokenizer, on_error=&quot;warn&quot;)
validator.validate(tokens, span)
</code></pre></div>
<h2 id="on_error-behavior">⚠️ on_error Behavior<a class="headerlink" href="#on_error-behavior" title="Permanent link">&para;</a></h2>
<p>All validators accept an on_error argument:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>"raise"</code></td>
<td>Raises an exception immediately (strict mode).</td>
</tr>
<tr>
<td><code>"warn"</code></td>
<td>Logs a warning and continues execution.</td>
</tr>
</tbody>
</table>
<p>This allows you to use strict checks during development, but run more flexibly during large-scale preprocessing.</p>
<h2 id="skipping-only-the-broken-spans">Skipping Only the Broken Spans<a class="headerlink" href="#skipping-only-the-broken-spans" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>valid_spans = []
for span in token_entity_spans:
    try:
        validator.validate(tokens, span)
        valid_spans.append(span)
    except ValueError:
        continue  # Skip just this one
</code></pre></div>
<h2 id="implementing-custom-validators">🛠️ Implementing Custom Validators<a class="headerlink" href="#implementing-custom-validators" title="Permanent link">&para;</a></h2>
<p>You can easily extend Chisel by writing your own validator classes that follow the appropriate protocol.</p>
<h3 id="custom-parsevalidator">✅ Custom <code>ParseValidator</code><a class="headerlink" href="#custom-parsevalidator" title="Permanent link">&para;</a></h3>
<p>To write a custom validator that checks the parsed spans before tokenization, inherit from or implement the ParseValidator protocol:</p>
<div class="highlight"><pre><span></span><code>from chisel.extraction.base.protocols import ParseValidator
from chisel.extraction.models import EntitySpan

class NoOverlappingSpansValidator(ParseValidator):
    &quot;&quot;&quot;
    Ensures that no two entity spans overlap in character space.
    &quot;&quot;&quot;

    def __init__(self, on_error: Literal[&quot;warn&quot;, &quot;raise&quot;] = &quot;warn&quot;):
        self.on_error = on_error

    def validate(self, text: str, entities: list[EntitySpan]) -&gt; None:
        sorted_entities = sorted(entities, key=lambda e: e.start)
        for i in range(len(sorted_entities) - 1):
            if sorted_entities[i].end &gt; sorted_entities[i + 1].start:
                msg = (
                    f&quot;Overlapping spans: &#39;{sorted_entities[i]}&#39; &quot;
                    f&quot;and &#39;{sorted_entities[i + 1]}&#39;&quot;
                )
                if self.on_error == &quot;warn&quot;:
                    print(&quot;Warning:&quot;, msg)
                else:
                    raise ValueError(msg)
</code></pre></div>
<h3 id="custom-tokenalignmentvalidator">✅ Custom TokenAlignmentValidator<a class="headerlink" href="#custom-tokenalignmentvalidator" title="Permanent link">&para;</a></h3>
<p>To write a validator that checks alignment between tokens and entities, use the TokenAlignmentValidator protocol:</p>
<div class="highlight"><pre><span></span><code>from chisel.extraction.base.protocols import TokenAlignmentValidator
from chisel.extraction.models import Token, TokenEntitySpan

class NoEmptySpanValidator(TokenAlignmentValidator):
    &quot;&quot;&quot;
    Ensures no TokenEntitySpan has zero token indices.
    &quot;&quot;&quot;

    def __init__(self, on_error: Literal[&quot;warn&quot;, &quot;raise&quot;] = &quot;warn&quot;):
        self.on_error = on_error

    def validate(
        self,
        tokens: list[Token],
        token_entity_spans: list[TokenEntitySpan],
    ) -&gt; None:
        for span in token_entity_spans:
            if not span.token_indices:
                msg = f&quot;TokenEntitySpan for &#39;{span.entity.text}&#39; has no token indices.&quot;
                if self.on_error == &quot;warn&quot;:
                    print(&quot;Warning:&quot;, msg)
                else:
                    raise ValueError(msg)
</code></pre></div>
<h3 id="tip-chain-multiple-validators">🧪 Tip: Chain Multiple Validators<a class="headerlink" href="#tip-chain-multiple-validators" title="Permanent link">&para;</a></h3>
<p>You can combine multiple validators in your pipeline like so:
<div class="highlight"><pre><span></span><code>parse_validators = [
    DefaultParseValidator(on_error=&quot;raise&quot;),
    NoOverlappingSpansValidator(on_error=&quot;warn&quot;),
]

for validator in parse_validators:
    validator.validate(text, entities)
</code></pre></div></p>
<p>This design encourages small, composable units of validation logic.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "toc.integrate", "content.code.annotate", "content.action.edit"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>